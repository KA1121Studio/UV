<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>UV</title>
</head>
<body>
  <h2>Ultraviolet Proxy</h2>

  <input id="url" placeholder="https://example.com" style="width:300px;">
  <button onclick="go()">Go</button>

  <script src="/uv/uv.bundle.js"></script>
  <script src="/uv/uv.config.js"></script>
  
<script>
  async function go() {
    try {
      console.log('Go clicked');

      console.log('Ultraviolet:', Ultraviolet);
      console.log('__uv$config:', __uv$config);

      if ('serviceWorker' in navigator) {
        console.log('Registering SW...');
        await navigator.serviceWorker.register('/uv/sw.js');
        console.log('Waiting SW ready...');
        await navigator.serviceWorker.ready;
        console.log('SW ready');
      }

      const input = document.getElementById('url').value.trim();
      console.log('Raw input:', input);

      const url = input.startsWith('http') ? input : 'https://' + input;
      console.log('Final URL:', url);

      const encoded = Ultraviolet.codec.xor.encode(url);
      console.log('Encoded:', encoded);

      const target = __uv$config.prefix + encoded;
      console.log('Target:', target);

      location.href = target;

    } catch (e) {
      console.error('GO ERROR:', e);
      alert('GO ERROR: ' + e.message);
    }
  }
</script>


</body>
</html>
